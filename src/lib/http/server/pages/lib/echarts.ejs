<% const cdnJson5URL = "https://cdn.bootcdn.net/ajax/libs/json5/0.5.1" %>
<% const cdnEchartsURL = "https://cdn.bootcdn.net/ajax/libs/echarts/5.1.0" %>
<script src="<%- cdnJson5URL %>/json5.min.js"></script>
<script src="<%- cdnEchartsURL %>/echarts.min.js"></script>
<script src="<%- cdnEchartsURL %>/theme/dark.min.js"></script>
<script>
__ONLOADS__.push(function() {
    const elements = document.querySelectorAll("code[class*='language-echarts']");
    for (let ele of elements) {
        const parent = ele.parentElement;
        const contentWidth = parent.clientWidth;
        const imgW = parseInt(contentWidth * 0.95);
        const imgH = parseInt((imgW / 16) * 9);

        let text = ele.innerText.toString().trim();
        const maybeTextStart = "option = ";
        const maybeTextEnd = ";";
        if (text.startsWith(maybeTextStart)) {
            text = text.substr(maybeTextStart.length);
        }
        if (text.endsWith(maybeTextEnd)) {
            text = text.substr(0, text.length - maybeTextEnd.length);
        }
        const options = JSON5.parse(text);
        if (undefined === options['backgroundColor']) {
            options['backgroundColor'] = "rgba(0, 0, 0, 0)";
        }
        ele.remove();

        const g = document.createElement("div");
        g.style.padding = "0";
        g.style.margin = "0";
        g.style.width = `${imgW}px`;
        g.style.height = `${imgH}px`;
        parent.appendChild(g);

        echarts.init(g, 'dark', {renderer: 'svg'}).setOption(options);
    }
});
</script>